<div class="container">
    <h2>The Shows</h2>
    
    <div class="card">
        <div class="card-header">
            Add Show(s)
            <a href="#" (click)="toggleCollapsed()">
                <i class="pull-right  fa"
                   [class.fa-chevron-up]="collapsed === false"
                   [class.fa-chevron-down]="collapsed === true"></i>
            </a>
        </div>
        <div class="card-block" style="max-height: 300px; overflow-y: auto"
             [class.hidden]="collapsed === true">

            <div class="form-group row">
                <div class="col-10">
                    <input type="text" class="form-control mb-2 mr-sm-2 mb-sm-0" placeholder="Search for Show"
                           [(ngModel)]="searchTerms" />
                </div>
                <button type="button" class="btn btn-primary" (click)="searchShows()">Search</button>
            </div>

            <table class="table table-bordered table-hover">
                <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Status</th>
                    <th>First Aired</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let show of shows"
                    [class.table-active]="show === selectedShow">
                    <td (click)="addShow(show)">
                        <i class="fa fa-check" aria-hidden="true"></i>
                    </td>
                    <td>{{show.name}}</td>
                    <td>{{show.status}}</td>
                    <td>{{show.firstAired | date: "MM/dd/yyyy"}}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="card" style="margin-top: 15px;">
        <div class="card-header">
            My Shows
            <a href="#" (click)="refresh()">
                <i class="pull-right fa fa-refresh"></i>
            </a>
        </div>
        <div class="card-block">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th>First Aired</th>
                        <th>Airs On</th>
                        <th>Last Aired</th>
                        <th>Next Airs</th>
                    </tr>
                </thead>
                <tbody *ngFor="let show of trackedShows">
                    <tr [class.table-success]="airedYesterday(show)">
                        <td>
                            <a href="#" (click)="toggleShowExpanded(show)">
                                <i class="fa"
                                   [class.fa-chevron-up]="trackedShowsExpanded.indexOf(show) !== -1"
                                   [class.fa-chevron-down]="trackedShowsExpanded.indexOf(show) === -1"></i>
                            </a>
                            <a href="#" (click)="deleteShow(show)">
                                <i class="fa fa-trash"></i>
                            </a>
                        </td>
                        <td>{{show.name}}</td>
                        <td>{{show.firstAiredDate | date: "MM/dd/yyyy"}}</td>
                        <td>{{show.airDay}}{{show.airTime != null && show.airTime.length > 0 ? 'at ' + airTime : ''}}</td>
                        <td>{{show.lastEpisode === null ? "N/A" : (show.lastEpisode.airDate | date: "MM/dd/yyyy")}}</td>
                        <td>{{show.nextEpisode === null ? "N/A" : (show.nextEpisode.airDate | date: "EEEE, LLLL dd, yyyy")}}</td>
                    </tr>
                    <tr [class.hidden]="trackedShowsExpanded.indexOf(show) === -1">
                        <td colspan="6">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <td></td>
                                        <th>Season</th>
                                        <th>Episode</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngIf="show.lastEpisode !== null">
                                        <th>Last Episode</th>
                                        <td>{{show.lastEpisode.seasonNumber}}</td>
                                        <td>{{show.lastEpisode.episodeNumber}}</td>
                                    </tr>
                                    <tr *ngIf="show.nextEpisode !== null">
                                        <th>Next Episode</th>
                                        <td>{{show.nextEpisode.seasonNumber}}</td>
                                        <td>{{show.nextEpisode.episodeNumber}}</td>
                                    </tr>

                                </tbody>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
